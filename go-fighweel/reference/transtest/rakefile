$: << File.expand_path(File.dirname(__FILE__))

require 'pp'
require 'lib/geo'
include Geo
require 'rake/clean'

require 'lib/rakeutils'
include RakeUtils

require 'rake/clean'

SRC_DIR  = "src"
DST_DIR = "dst"

task :default => %w{compile}

rule ".json" => [->(f){get_src_file(SRC_DIR,"rb",DST_DIR, f)}] do |t|
     puts "Writing #{t.name}"
     mkdir_p? t.name.pathmap("%d") 
     txt = run_script(t.source, :json)
     File.write(t.name, txt)
end

_ , dst_files = get_src_dst SRC_DIR, "rb", DST_DIR, "json" 

task :compile => dst_files

CLEAN.include(dst_files)


